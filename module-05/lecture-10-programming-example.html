<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lecture 10: Programming Example - Predictive Modeling MOOC</title>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Helvetica", "Arial", sans-serif;
        line-height: 1.6;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8f9fa;
      }

      .container {
        background-color: white;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .nav-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px 30px;
        border-radius: 8px 8px 0 0;
        margin: -30px -30px 30px -30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .nav-header h1 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .nav-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .btn {
        display: inline-block;
        padding: 10px 20px;
        text-decoration: none;
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .btn-colab {
        background-color: #f9ab00;
        color: #1a1a1a;
        border: 2px solid #f9ab00;
      }

      .btn-colab:hover {
        background-color: #ff9900;
        border-color: #ff9900;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(249, 171, 0, 0.3);
      }

      .btn-github {
        background-color: transparent;
        color: white;
        border: 2px solid white;
      }

      .btn-github:hover {
        background-color: white;
        color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
      }

      .jupyter-content {
        margin-top: 20px;
      }

      /* Notebook cell styling */
      div.cell {
        margin-bottom: 1.5rem;
      }

      div.input_area {
        border-left: 3px solid #667eea;
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
      }

      div.output_area {
        padding: 10px;
        border-left: 3px solid #28a745;
        background-color: #f8f9fa;
        border-radius: 4px;
        margin-top: 10px;
      }

      /* Code highlighting */
      .highlight {
        background-color: #f8f9fa;
        border-radius: 4px;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 15px;
        }

        .nav-header {
          padding: 15px;
          margin: -15px -15px 15px -15px;
        }

        .nav-header h1 {
          font-size: 1.2rem;
        }

        .nav-buttons {
          width: 100%;
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="nav-header">
        <h1>Lecture 10: Programming Example</h1>
        <div class="nav-buttons">
          <a
            href="https://colab.research.google.com/github/pmarcelino/predictive-modeling/blob/main/04-implementation/module-05/lecture-10-programming-example.ipynb"
            target="_blank"
            rel="noopener"
            class="btn btn-colab"
          >
            â–¶ Open in Colab
          </a>
          <a
            href="https://github.com/pmarcelino/predictive-modeling/blob/main/04-implementation/module-05/lecture-10-programming-example.ipynb"
            target="_blank"
            rel="noopener"
            class="btn btn-github"
          >
            ðŸ“‚ View on GitHub
          </a>
        </div>
      </div>
      <div class="jupyter-content">
        <main>
          <div class="border-box-sizing" id="notebook" tabindex="-1">
            <div class="container" id="notebook-container">
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=844b5aae"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h1
                      id="Lecture-10:-End-to-End-Machine-Learning-Pipeline---Programming-Example"
                      >Lecture 10: End-to-End Machine Learning Pipeline -
                      Programming Example<a
                        class="anchor-link"
                        href="#Lecture-10:-End-to-End-Machine-Learning-Pipeline---Programming-Example"
                      ></a
                    ></h1>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=285a4396"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2
                      id="Introduction:-Building-a-Complete-Production-Ready-Forecasting-System"
                      >Introduction: Building a Complete Production-Ready
                      Forecasting System<a
                        class="anchor-link"
                        href="#Introduction:-Building-a-Complete-Production-Ready-Forecasting-System"
                      ></a></h2
                    ><p
                      >Welcome to your final lecture! Over the past lectures,
                      you've mastered essential machine learning (ML) skills:
                      data cleaning, feature engineering, statistical analysis,
                      visualization, linear regression, and ensemble methods.
                      Today, you'll integrate all these skills into
                      <strong>one complete end-to-end pipeline</strong> - taking
                      Capital City Bikes from raw operational data through to
                      production-ready demand forecasting models with rigorous
                      evaluation and deployment recommendations.</p
                    >
                    <p
                      >Think of this as your graduation project: you'll work
                      through the exact workflow professional ML engineers
                      follow daily. Starting with data validation and ending
                      with deployment decisions, you'll see how every skill
                      you've learned fits into the bigger picture. This isn't
                      just about building models - it's about building
                      <strong>trust in your predictions</strong> through
                      systematic data preparation, thoughtful feature
                      engineering, rigorous evaluation, and transparent business
                      communication.</p
                    >
                    <p
                      >Your client, Capital City Bikes, needs more than accurate
                      forecasts - they need a complete system they can trust,
                      explain to investors, and deploy confidently for their
                      $2.3M municipal contract. Your end-to-end pipeline will
                      demonstrate the professional rigor that justifies Series B
                      funding rounds.</p
                    >
                    <blockquote>
                      <p><strong>ðŸš€ Interactive Learning Alert</strong></p>
                      <p
                        >This is a comprehensive hands-on capstone project
                        integrating all course concepts. For the best
                        experience:</p
                      >
                      <ul>
                        <li
                          ><strong>Click "Open in Colab"</strong> at the bottom
                          to run code interactively</li
                        >
                        <li
                          ><strong>Execute each code cell</strong> by pressing
                          <strong>Shift + Enter</strong></li
                        >
                        <li
                          ><strong>Complete the challenges</strong> to reinforce
                          your end-to-end ML skills</li
                        >
                        <li
                          ><strong>Think like a professional consultant</strong>
                          - every decision impacts deployment success</li
                        >
                      </ul>
                    </blockquote>
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=98506cb2"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2 id="Step-1:-Data-Quality-Assessment-and-Cleaning"
                      >Step 1: Data Quality Assessment and Cleaning<a
                        class="anchor-link"
                        href="#Step-1:-Data-Quality-Assessment-and-Cleaning"
                      ></a></h2
                    ><p
                      >Before rushing into modeling, professional consultants
                      always validate data quality. Even with "clean" datasets,
                      we systematically verify integrity, check for edge cases,
                      and ensure our foundation is solid. This disciplined
                      approach prevents downstream surprises and builds
                      stakeholder confidence.</p
                    >
                    <p
                      ><strong
                        >From the lecture "Data Quality &amp; Cleaning
                        Essentials"</strong
                      >, we learned the unified cleaning workflow: assess
                      quality, identify issues, apply systematic fixes with
                      transparency. Let's apply these principles to establish
                      our reliable data foundation.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=19408730"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Import essential libraries</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="c1"># Load the Washington D.C. bike-sharing dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/pmarcelino/predictive-modeling/main/datasets/dataset.csv"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== STEP 1: DATA QUALITY ASSESSMENT ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Convert datetime and sort chronologically for time series integrity</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'datetime'</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Quick data quality checks</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Structural Overview ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Dataset shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> rows Ã— </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> columns"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Time range: </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Total hours: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Check for missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Missing Data Assessment ---"</span><span class="p">)</span>
<span class="n">missing_summary</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">missing_pct</span> <span class="o">=</span> <span class="p">(</span><span class="n">missing_summary</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">missing_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Missing_Count'</span><span class="p">:</span> <span class="n">missing_summary</span><span class="p">,</span> <span class="s1">'Missing_%'</span><span class="p">:</span> <span class="n">missing_pct</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">missing_df</span><span class="p">[</span><span class="n">missing_df</span><span class="p">[</span><span class="s1">'Missing_Count'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>

<span class="k">if</span> <span class="n">missing_df</span><span class="p">[</span><span class="s1">'Missing_Count'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ No missing values detected - excellent data quality!</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âš  Found missing values - will handle in cleaning step</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Value range validation</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Value Range Validation ---"</span><span class="p">)</span>
<span class="n">reasonable_ranges</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'temp'</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span>
    <span class="s1">'humidity'</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">'windspeed'</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
    <span class="s1">'count'</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">issues_found</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">reasonable_ranges</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">below</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">above</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">below</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">above</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">issues_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âš  </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">below</span><span class="si">}</span><span class="s2"> values too low, </span><span class="si">{</span><span class="n">above</span><span class="si">}</span><span class="s2"> values too high"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">: All values within expected range [</span><span class="si">{</span><span class="n">min_val</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">max_val</span><span class="si">}</span><span class="s2">]"</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">issues_found</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ All values within reasonable ranges - data validated!"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Timeline Continuity Check ---"</span><span class="p">)</span>
<span class="c1"># Check for duplicate timestamps</span>
<span class="n">duplicates</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Duplicate timestamps: </span><span class="si">{</span><span class="n">duplicates</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Check for missing hours</span>
<span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">expected_hours</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">'h'</span><span class="p">)</span>
<span class="n">actual_hours</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">missing_hours</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_hours</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_hours</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Missing hours in timeline: </span><span class="si">{</span><span class="n">missing_hours</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">duplicates</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">missing_hours</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Perfect timeline continuity - ready for time series analysis!</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Create clean dataset for subsequent analysis</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Creating Clean Dataset ---"</span><span class="p">)</span>
<span class="n">df_clean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ df_clean created: </span><span class="si">{</span><span class="n">df_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> rows Ã— </span><span class="si">{</span><span class="n">df_clean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> columns"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Data quality validated and ready for feature engineering!"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=affd5c08"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <p><strong>What this does:</strong></p>
                    <ul>
                      <li
                        >Loads dataset and validates data quality
                        systematically</li
                      >
                      <li
                        >Checks for missing values, impossible values, timeline
                        continuity</li
                      >
                      <li
                        >Creates <code>df_clean</code> as validated foundation
                        for the next steps</li
                      >
                    </ul>
                    <p
                      ><strong>Business value:</strong> This systematic
                      validation ensures Capital City Bikes can trust their data
                      foundation. Any quality issues are identified and resolved
                      transparently before they contaminate modeling results.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=c2497188"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h3 id="Challenge-1:-Outlier-Detection-and-Investigation"
                      >Challenge 1: Outlier Detection and Investigation<a
                        class="anchor-link"
                        href="#Challenge-1:-Outlier-Detection-and-Investigation"
                      ></a></h3
                    ><p
                      >Your client asks: "Are there any unusual windspeed
                      conditions we should investigate before modeling?"
                      Implement outlier detection using the IQR method to
                      identify extreme windspeed periods.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=7cbcf1a6"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Your code here - detect outliers using IQR method</span>

<span class="c1"># Calculate IQR (Interquartile Range) for windspeed</span>
<span class="n">Q1</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'_____'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">_____</span><span class="p">)</span>  <span class="c1"># 25th percentile</span>
<span class="n">Q3</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'_____'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">_____</span><span class="p">)</span>  <span class="c1"># 75th percentile</span>
<span class="n">IQR</span> <span class="o">=</span> <span class="n">_____</span> <span class="o">-</span> <span class="n">_____</span>

<span class="c1"># Define outlier boundaries</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>

<span class="c1"># Identify outliers</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">_____</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">_____</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"=== OUTLIER DETECTION (IQR METHOD) ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Q1 (25th percentile): </span><span class="si">{</span><span class="n">Q1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Q3 (75th percentile): </span><span class="si">{</span><span class="n">Q3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"IQR: </span><span class="si">{</span><span class="n">IQR</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Lower bound: </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Upper bound: </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Outliers detected: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span><span class="si">}</span><span class="s2"> observations (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df_clean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>

<span class="c1"># Examine top outliers</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Top 5 high-windspeed outliers:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">outliers</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">)[[</span><span class="s1">'datetime'</span><span class="p">,</span> <span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">,</span> <span class="s1">'weather'</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">]])</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=78f79918"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ’¡ <strong>Tip</strong> (click to expand)</summary
                      >
                      <p
                        >The IQR method uses quartiles to define outlier
                        boundaries: Q1 (25th percentile) and Q3 (75th
                        percentile) define the "box" in a box plot, IQR = Q3 -
                        Q1 is the box height. Standard outlier boundaries are Q1
                        - 1.5Ã—IQR (lower) and Q3 + 1.5Ã—IQR (upper). Use
                        <code>.quantile(0.25)</code> for Q1 and
                        <code>.quantile(0.75)</code> for Q3. Filter outliers
                        with boolean indexing:
                        <code
                          >df[(df['windspeed'] &lt; lower_bound) |
                          (df['windspeed'] &gt; upper_bound)]</code
                        >. The <code>|</code> operator means "OR" - values below
                        lower bound OR above upper bound. Examine outliers using
                        <code>.nlargest(5, 'windspeed')</code> to see if they're
                        legitimate events (storms, extreme weather) or
                        measurement errors. At this stage, windspeed is still in
                        original units (0-67 normalized scale from the dataset),
                        so outlier boundaries will be in these original units.
                        High windspeed outliers may indicate extreme weather
                        events that significantly impact bike demand, so we
                        typically flag them for transparency in reporting to
                        clients.</p
                      >
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=a7aea9b8"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ¤« <strong>Solution</strong> (click to expand)</summary
                      >
                      <div class="highlight">
                        <pre><span></span><span class="c1"># Calculate IQR for windspeed</span>
<span class="n">Q1</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">Q3</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>

<span class="c1"># Define outlier boundaries</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>

<span class="c1"># Identify outliers</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"=== OUTLIER DETECTION (IQR METHOD) ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Q1 (25th percentile): </span><span class="si">{</span><span class="n">Q1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Q3 (75th percentile): </span><span class="si">{</span><span class="n">Q3</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"IQR: </span><span class="si">{</span><span class="n">IQR</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Lower bound: </span><span class="si">{</span><span class="n">lower_bound</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Upper bound: </span><span class="si">{</span><span class="n">upper_bound</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (scaled)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Outliers detected: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span><span class="si">}</span><span class="s2"> observations (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df_clean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>

<span class="c1"># Examine top outliers</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Top 5 high-windspeed outliers:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">outliers</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">)[[</span><span class="s1">'datetime'</span><span class="p">,</span> <span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">,</span> <span class="s1">'weather'</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">]])</span>
    
    <span class="c1"># Add outlier flag for transparency</span>
    <span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_windspeed_outlier'</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'windspeed'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Windspeed outliers flagged for transparency in analysis"</span><span class="p">)</span>
</pre>
                      </div>
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=f9652f35"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=6b5a5d23"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2 id="Step-2:-Feature-Engineering-and-Preprocessing"
                      >Step 2: Feature Engineering and Preprocessing<a
                        class="anchor-link"
                        href="#Step-2:-Feature-Engineering-and-Preprocessing"
                      ></a></h2
                    ><p
                      >With validated data, we now engineer features that expose
                      patterns for machine learning.
                      <strong
                        >From the lectures in the module "Data
                        Preparation"</strong
                      >, we learned categorical encoding, feature scaling,
                      cyclical time encoding, and temporal features. These
                      transformations convert raw data into optimized machine
                      learning inputs.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=abe95f2e"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Import preprocessing tools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== STEP 2: FEATURE ENGINEERING ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Extract temporal components from datetime</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Temporal Feature Extraction ---"</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'dayofweek'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'month'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Extracted: hour (0-23), dayofweek (0-6), month (1-12)"</span><span class="p">)</span>

<span class="c1"># Binary indicators for business-critical conditions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Binary Indicator Creation ---"</span><span class="p">)</span>
<span class="n">rush_hours</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">]</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_rush_hour'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rush_hours</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_weekend'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'dayofweek'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_night'</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">22</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ is_rush_hour: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_rush_hour'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of hours"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ is_weekend: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_weekend'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of hours"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ is_night: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_night'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of hours"</span><span class="p">)</span>

<span class="c1"># Cyclical encoding for continuous time (hour and day cycles)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Cyclical Time Encoding ---"</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour_cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'day_sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'dayofweek'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'day_cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'dayofweek'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Hour cycle: hour_sin, hour_cos (24-hour continuity)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Day cycle: day_sin, day_cos (7-day continuity)"</span><span class="p">)</span>

<span class="c1"># Verify cyclical encoding works (hour 23 should be close to hour 0)</span>
<span class="n">hour_23_encoding</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">23</span><span class="p">][[</span><span class="s1">'hour_sin'</span><span class="p">,</span> <span class="s1">'hour_cos'</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">hour_0_encoding</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'hour'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][[</span><span class="s1">'hour_sin'</span><span class="p">,</span> <span class="s1">'hour_cos'</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Verification - Hour 23: sin=</span><span class="si">{</span><span class="n">hour_23_encoding</span><span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, cos=</span><span class="si">{</span><span class="n">hour_23_encoding</span><span class="p">[</span><span class="s1">'hour_cos'</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Verification - Hour 0:  sin=</span><span class="si">{</span><span class="n">hour_0_encoding</span><span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, cos=</span><span class="si">{</span><span class="n">hour_0_encoding</span><span class="p">[</span><span class="s1">'hour_cos'</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Values are close - cyclical continuity preserved!"</span><span class="p">)</span>

<span class="c1"># Feature scaling for weather variables</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Feature Scaling (Weather Variables) ---"</span><span class="p">)</span>
<span class="n">weather_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'atemp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Before scaling:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="n">weather_features</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">'mean'</span><span class="p">,</span> <span class="s1">'std'</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">df_clean</span><span class="p">[</span><span class="n">weather_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="n">weather_features</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">After scaling:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="n">weather_features</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">'mean'</span><span class="p">,</span> <span class="s1">'std'</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Weather features standardized (meanâ‰ˆ0, stdâ‰ˆ1)"</span><span class="p">)</span>

<span class="c1"># Lag features for sequential patterns</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Lag Feature Creation ---"</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>

<span class="c1"># Handle NaN values created by shift</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ demand_lag_1h: Previous hour's demand (captures momentum)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ demand_lag_24h: Same hour yesterday (captures daily patterns)"</span><span class="p">)</span>

<span class="c1"># Check lag feature correlations</span>
<span class="n">corr_1h</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">])</span>
<span class="n">corr_24h</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Lag correlations with current demand:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  1-hour lag:  r = </span><span class="si">{</span><span class="n">corr_1h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  24-hour lag: r = </span><span class="si">{</span><span class="n">corr_24h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Feature engineering complete: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_clean</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="s2"> total columns"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Ready for exploratory analysis and modeling!"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=899a59f1"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <p><strong>What this does:</strong></p>
                    <ul>
                      <li
                        >Extracts temporal components (hour, day, month) from
                        datetime</li
                      >
                      <li
                        >Creates binary indicators for operational segments
                        (rush hour, weekend, night)</li
                      >
                      <li
                        >Implements cyclical encoding ensuring time continuity
                        (11pm â†’ midnight)</li
                      >
                      <li
                        >Scales weather features to comparable ranges (mean=0,
                        std=1)</li
                      >
                      <li
                        >Generates lag features capturing sequential demand
                        patterns</li
                      >
                      <li
                        >Validates feature quality through correlation
                        analysis</li
                      >
                    </ul>
                    <p
                      ><strong>Business value:</strong> These engineered
                      features transform raw measurements into ML-ready
                      predictors that expose temporal patterns, operational
                      contexts, and sequential dependencies - the patterns that
                      drive accurate demand forecasting.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=1d4ea626"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h3 id="Challenge-2:-Create-Rolling-Window-Features"
                      >Challenge 2: Create Rolling Window Features<a
                        class="anchor-link"
                        href="#Challenge-2:-Create-Rolling-Window-Features"
                      ></a></h3
                    ><p
                      >Your client asks: "Can we capture demand trends over
                      recent hours? I'd like to understand short-term and daily
                      patterns." Implement rolling window features that
                      summarize recent demand history.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=9b36b276"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Your code here - create rolling window features</span>

<span class="c1"># 3-hour rolling average (short-term trend)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">_____</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">_____</span><span class="p">()</span>

<span class="c1"># 24-hour rolling average (daily baseline)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">_____</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">_____</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== ROLLING WINDOW FEATURES ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ demand_3h_avg: Rolling average of past 3 hours (short-term trend)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ demand_24h_avg: Rolling average of past 24 hours (daily baseline)"</span><span class="p">)</span>

<span class="c1"># Visualize rolling patterns</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">3-hour rolling average statistics:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Mean: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Std: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">24-hour rolling average statistics:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Mean: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Std: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=edbb8440"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ’¡ <strong>Tip</strong> (click to expand)</summary
                      >
                      <p
                        >Rolling window features use pandas
                        <code>.rolling(window=n)</code> to calculate statistics
                        over the past n observations. ALWAYS use
                        <code>.shift(1)</code> before <code>.rolling()</code> to
                        prevent data leakage - without it, the current value
                        you're trying to predict gets included in the "past"
                        window! The pattern is:
                        <code
                          >df['count'].shift(1).rolling(window=3).mean()</code
                        >
                        for a 3-hour average. Use <code>window=3</code> for
                        short-term trends and <code>window=24</code> for daily
                        baselines. Set <code>min_periods=1</code> to handle the
                        first few rows where full windows aren't available. The
                        3-hour average captures immediate trends (is demand
                        rising or falling in the past few hours?), while the
                        24-hour average provides a stable daily baseline that
                        accounts for typical patterns at each hour. These
                        features help models understand not just current
                        conditions but recent demand trajectories. For example,
                        if demand_3h_avg is significantly higher than
                        demand_24h_avg, it signals an unusual surge requiring
                        proactive bike rebalancing.</p
                      >
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=52645f01"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ¤« <strong>Solution</strong> (click to expand)</summary
                      >
                      <div class="highlight">
                        <pre><span></span><span class="c1"># 3-hour rolling average (short-term trend)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># 24-hour rolling average (daily baseline)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== ROLLING WINDOW FEATURES ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ demand_3h_avg: Rolling average of past 3 hours (short-term trend)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ demand_24h_avg: Rolling average of past 24 hours (daily baseline)"</span><span class="p">)</span>

<span class="c1"># Visualize rolling patterns</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">3-hour rolling average statistics:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Mean: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Std: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">24-hour rolling average statistics:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Mean: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Std: </span><span class="si">{</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Show correlation with current demand</span>
<span class="n">corr_3h</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">])</span>
<span class="n">corr_24h</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Correlation with current demand:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  3-hour rolling avg:  r = </span><span class="si">{</span><span class="n">corr_3h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  24-hour rolling avg: r = </span><span class="si">{</span><span class="n">corr_24h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
                      </div>
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=5ff7da9a"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=d0e50383"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2 id="Step-3:-Exploratory-Data-Analysis-and-Visualization"
                      >Step 3: Exploratory Data Analysis and Visualization<a
                        class="anchor-link"
                        href="#Step-3:-Exploratory-Data-Analysis-and-Visualization"
                      ></a></h2
                    ><p
                      >Before modeling, we explore our engineered features to
                      validate they capture real patterns.
                      <strong
                        >From the lectures in module "Data Exploration"</strong
                      >, we learned statistical analysis and visualization
                      techniques. This exploration builds confidence in our
                      feature engineering and reveals insights that guide
                      modeling decisions.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=d436bad9"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"=== STEP 3: EXPLORATORY DATA ANALYSIS ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Descriptive statistics for key variables</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Descriptive Statistics ---"</span><span class="p">)</span>
<span class="n">key_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">]</span>
<span class="n">stats_summary</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">key_metrics</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stats_summary</span><span class="p">)</span>

<span class="c1"># Seasonal demand comparison</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Seasonal Demand Patterns ---"</span><span class="p">)</span>
<span class="n">season_names</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">'Spring'</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">'Summer'</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">'Fall'</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">'Winter'</span><span class="p">}</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'season_name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'season'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">season_names</span><span class="p">)</span>

<span class="n">seasonal_stats</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'season_name'</span><span class="p">)[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">'mean'</span><span class="p">,</span> <span class="s1">'std'</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seasonal_stats</span><span class="p">)</span>

<span class="n">peak_season</span> <span class="o">=</span> <span class="n">seasonal_stats</span><span class="p">[</span><span class="s1">'mean'</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
<span class="n">low_season</span> <span class="o">=</span> <span class="n">seasonal_stats</span><span class="p">[</span><span class="s1">'mean'</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Peak season: </span><span class="si">{</span><span class="n">peak_season</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">seasonal_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">peak_season</span><span class="p">,</span><span class="w"> </span><span class="s1">'mean'</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> bikes/hour)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Low season: </span><span class="si">{</span><span class="n">low_season</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">seasonal_stats</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">low_season</span><span class="p">,</span><span class="w"> </span><span class="s1">'mean'</span><span class="p">]</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> bikes/hour)"</span><span class="p">)</span>

<span class="c1"># Correlation analysis with engineered features</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Correlation Analysis ---"</span><span class="p">)</span>
<span class="n">correlation_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'hour'</span><span class="p">,</span> <span class="s1">'dayofweek'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">,</span>
                        <span class="s1">'is_rush_hour'</span><span class="p">,</span> <span class="s1">'is_weekend'</span><span class="p">,</span> <span class="s1">'demand_lag_1h'</span><span class="p">,</span> <span class="s1">'demand_lag_24h'</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">]</span>

<span class="c1"># Calculate correlations with target variable</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">correlation_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Features ranked by correlation with demand:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">correlations</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Strongest positive predictor: </span><span class="si">{</span><span class="n">correlations</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> (r = </span><span class="si">{</span><span class="n">correlations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Strongest negative predictor: </span><span class="si">{</span><span class="n">correlations</span><span class="p">[</span><span class="n">correlations</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (r = </span><span class="si">{</span><span class="n">correlations</span><span class="p">[</span><span class="n">correlations</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

<span class="c1"># Create visualizations showcasing engineered features</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Creating Visualizations ---"</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># Panel 1: Lag Feature Autocorrelation - 1-hour lag</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="n">slope_1h</span><span class="p">,</span> <span class="n">intercept_1h</span><span class="p">,</span> <span class="n">r_1h</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">],</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">],</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">],</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'steelblue'</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">],</span> 
                <span class="n">slope_1h</span> <span class="o">*</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_1h'</span><span class="p">]</span> <span class="o">+</span> <span class="n">intercept_1h</span><span class="p">,</span>
                <span class="s1">'r--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'Linear fit (r = </span><span class="si">{</span><span class="n">r_1h</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Previous Hour Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Current Hour Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'1-Hour Lag Correlation (Momentum)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 2: Lag Feature Autocorrelation - 24-hour lag</span>
<span class="n">slope_24h</span><span class="p">,</span> <span class="n">intercept_24h</span><span class="p">,</span> <span class="n">r_24h</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">],</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">],</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">],</span> 
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkgreen'</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">],</span> 
                <span class="n">slope_24h</span> <span class="o">*</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_lag_24h'</span><span class="p">]</span> <span class="o">+</span> <span class="n">intercept_24h</span><span class="p">,</span>
                <span class="s1">'r--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'Linear fit (r = </span><span class="si">{</span><span class="n">r_24h</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">)'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Same Hour Yesterday Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Current Hour Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'24-Hour Lag Correlation (Daily Pattern)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 3: Binary Feature Impact - Combined view</span>
<span class="n">binary_features_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">'Rush</span><span class="se">\n</span><span class="s1">Hour'</span><span class="p">,</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_rush_hour'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">'count'</span><span class="p">],</span> 
     <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_rush_hour'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">'count'</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">'Weekend'</span><span class="p">,</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_weekend'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">'count'</span><span class="p">],</span> 
     <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_weekend'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">'count'</span><span class="p">]),</span>
    <span class="p">(</span><span class="s1">'Night</span><span class="se">\n</span><span class="s1">Time'</span><span class="p">,</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_night'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="s1">'count'</span><span class="p">],</span> 
     <span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'is_night'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">'count'</span><span class="p">])</span>
<span class="p">]</span>

<span class="n">positions</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'lightblue'</span><span class="p">,</span> <span class="s1">'lightcoral'</span><span class="p">,</span> <span class="s1">'lightblue'</span><span class="p">,</span> <span class="s1">'lightcoral'</span><span class="p">,</span> <span class="s1">'lightblue'</span><span class="p">,</span> <span class="s1">'lightcoral'</span><span class="p">]</span>
<span class="n">data_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">yes</span> <span class="ow">in</span> <span class="n">binary_features_data</span><span class="p">:</span>
    <span class="n">data_to_plot</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">no</span><span class="p">,</span> <span class="n">yes</span><span class="p">])</span>

<span class="n">bp</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
                        <span class="n">patch_artist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">boxprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">),</span>
                        <span class="n">medianprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">meanprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">'D'</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># Color the boxes</span>
<span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bp</span><span class="p">[</span><span class="s1">'boxes'</span><span class="p">],</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">binary_features_data</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Hourly Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Binary Feature Impact on Demand Distribution'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">bp</span><span class="p">[</span><span class="s1">'boxes'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bp</span><span class="p">[</span><span class="s1">'boxes'</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="s1">'No (0)'</span><span class="p">,</span> <span class="s1">'Yes (1)'</span><span class="p">],</span> 
                  <span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="c1"># Panel 4: Correlation Heatmap of Engineered Features</span>
<span class="n">heatmap_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">,</span> <span class="s1">'hour_sin'</span><span class="p">,</span> <span class="s1">'hour_cos'</span><span class="p">,</span> 
                    <span class="s1">'is_rush_hour'</span><span class="p">,</span> <span class="s1">'is_weekend'</span><span class="p">,</span> <span class="s1">'is_night'</span><span class="p">,</span> 
                    <span class="s1">'demand_lag_1h'</span><span class="p">,</span> <span class="s1">'demand_lag_24h'</span><span class="p">,</span> <span class="s1">'count'</span><span class="p">]</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">heatmap_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'RdBu_r'</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'right'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Feature Correlation Matrix'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>

<span class="c1"># Add correlation values for top/bottom relationships with target</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">heatmap_features</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
                                  <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                  <span class="n">color</span><span class="o">=</span><span class="s1">'white'</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">corr_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="s1">'black'</span><span class="p">)</span>

<span class="c1"># Add colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Correlation'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Visualizations complete - engineered features validated!"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Lag features show strong predictive power: 1h (r=</span><span class="si">{</span><span class="n">r_1h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">), 24h (r=</span><span class="si">{</span><span class="n">r_24h</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Binary features create meaningful demand segmentation"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Feature correlation matrix reveals relationships and independence"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=4e044b27"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <p><strong>What this does:</strong></p>
                    <ul>
                      <li>Creates four visualization panels</li>
                      <li
                        ><strong>Lag correlation scatters</strong> (panels 1-2):
                        Validate that demand_lag_1h and demand_lag_24h strongly
                        predict current demand (r â‰ˆ 0.8-0.9), proving sequential
                        patterns are captured</li
                      >
                      <li
                        ><strong>Binary feature box plots</strong> (panel 3):
                        Show how is_rush_hour, is_weekend, and is_night create
                        distinct demand distributions - visual evidence these
                        flags segment operational contexts effectively</li
                      >
                      <li
                        ><strong>Correlation heatmap</strong> (panel 4): Reveals
                        relationships among ALL engineered features - identifies
                        redundant features (high inter-feature correlation) vs.
                        complementary features (low inter-feature correlation
                        but high correlation with target)</li
                      >
                    </ul>
                    <p
                      ><strong>Business value:</strong> These visualizations
                      prove that Step 2 feature engineering works BEFORE
                      investing in modeling. Strong lag correlations justify
                      real-time demand monitoring systems. Binary feature
                      segmentation guides operational policy (different
                      strategies for rush hour vs. night). Correlation matrix
                      prevents redundant data collection and identifies most
                      cost-effective monitoring investments.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=ba64b848"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h3 id="Challenge-3:-Create-Diverse-Visualization-Types"
                      >Challenge 3: Create Diverse Visualization Types<a
                        class="anchor-link"
                        href="#Challenge-3:-Create-Diverse-Visualization-Types"
                      ></a></h3
                    ><p
                      >Your client requests: "Can you create additional
                      visualizations showing demand distributions and
                      multi-dimensional patterns? We want to understand
                      variability and combined effects." Create box plots and
                      heatmaps to reveal distribution patterns and interaction
                      effects.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=cdb5eaea"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Your code here - create box plots and heatmap</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Panel 1: Box plot - demand distribution by weather condition</span>
<span class="n">weather_labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">'Clear'</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">'Mist'</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">'Light Rain'</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">'Heavy Rain'</span><span class="p">}</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'weather_label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'weather'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">weather_labels</span><span class="p">)</span>

<span class="c1"># Create box plot showing distribution for each weather type</span>
<span class="n">weather_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'weather'</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">'count'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">]]</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">weather_data</span><span class="p">,</span> <span class="n">tick_labels</span><span class="o">=</span><span class="n">_____</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Weather Condition'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Hourly Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Demand Distribution by Weather'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 2: Heatmap - demand by hour and day of week</span>
<span class="n">hourly_daily</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">'_____'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">'_____'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">'_____'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">hourly_daily</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'YlOrRd'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'label'</span><span class="p">:</span> <span class="s1">'Avg Demand'</span><span class="p">})</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Day of Week (0=Mon, 6=Sun)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Hour of Day'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Demand Heatmap: Hour Ã— Day Patterns'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== ADVANCED VISUALIZATION INSIGHTS ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Box plot: Shows demand variability across weather conditions"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Heatmap: Reveals hour-day interaction patterns (weekday rush hours vs weekend leisure)"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=be02361a"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ’¡ <strong>Tip</strong> (click to expand)</summary
                      >
                      <p
                        >Box plots show distribution characteristics: the box
                        spans Q1 to Q3 (middle 50%), the line inside is the
                        median, whiskers extend to typical min/max, and dots are
                        outliers. Create data list using list comprehension:
                        <code
                          >[df_clean[df_clean['weather'] == i]['count'] for i in
                          [1, 2, 3, 4]]</code
                        >
                        gives you four arrays (one per weather type). Pass this
                        list to <code>plt.boxplot()</code> with
                        <code
                          >labels=['Clear', 'Mist', 'Light Rain', 'Heavy
                          Rain']</code
                        >. For heatmaps, use
                        <code
                          >df.pivot_table(values='count', index='hour',
                          columns='dayofweek', aggfunc='mean')</code
                        >
                        to create a matrix where rows=hours, columns=days,
                        cells=average demand. Then
                        <code>sns.heatmap()</code> with
                        <code>cmap='YlOrRd'</code> creates color-coded
                        visualization where darker colors = higher demand. The
                        heatmap will instantly reveal weekday morning/evening
                        peaks versus weekend midday patterns - visual
                        confirmation of temporal feature importance!</p
                      >
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=eb8db686"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ¤« <strong>Solution</strong> (click to expand)</summary
                      >
                      <div class="highlight">
                        <pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Panel 1: Box plot - demand distribution by weather condition</span>
<span class="n">weather_labels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">'Clear'</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">'Mist'</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">'Light Rain'</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">'Heavy Rain'</span><span class="p">}</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'weather_label'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'weather'</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">weather_labels</span><span class="p">)</span>

<span class="n">weather_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'weather'</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">][</span><span class="s1">'count'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">weather_data</span><span class="p">,</span> <span class="n">tick_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">'Clear'</span><span class="p">,</span> <span class="s1">'Mist'</span><span class="p">,</span> <span class="s1">'Light Rain'</span><span class="p">,</span> <span class="s1">'Heavy Rain'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Weather Condition'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Hourly Demand (bikes)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Demand Distribution by Weather'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 2: Heatmap - demand by hour and day of week</span>
<span class="n">hourly_daily</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">'count'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">'hour'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">'dayofweek'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">hourly_daily</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'YlOrRd'</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'label'</span><span class="p">:</span> <span class="s1">'Avg Demand'</span><span class="p">},</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">'.0f'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Day of Week (0=Mon, 6=Sun)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Hour of Day'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Demand Heatmap: Hour Ã— Day Patterns'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== ADVANCED VISUALIZATION INSIGHTS ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Box plot reveals: Clear weather has highest median and widest range"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Heatmap shows: Weekday hours 8 &amp; 17 are hottest (rush hours)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Pattern validated: Temporal features critical for accurate forecasting"</span><span class="p">)</span>
</pre>
                      </div>
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=bb72a7d7"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=088e39dc"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2 id="Step-4:-Linear-Regression-Baseline-Model"
                      >Step 4: Linear Regression Baseline Model<a
                        class="anchor-link"
                        href="#Step-4:-Linear-Regression-Baseline-Model"
                      ></a></h2
                    ><p
                      >With validated features, we build our baseline model.
                      <strong
                        >From the lecture "Linear Models for Prediction"</strong
                      >, Linear Regression provides interpretable predictions
                      with clear coefficient interpretation. This baseline
                      establishes performance that advanced models must beat to
                      justify their complexity.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=21ab8cab"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Import modeling tools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== STEP 4: LINEAR REGRESSION BASELINE ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Define feature columns for modeling</span>
<span class="n">feature_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Weather features (scaled)</span>
    <span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'atemp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">,</span>
    <span class="c1"># Temporal features (both raw and cyclical)</span>
    <span class="s1">'hour'</span><span class="p">,</span> <span class="s1">'hour_sin'</span><span class="p">,</span> <span class="s1">'hour_cos'</span><span class="p">,</span> <span class="s1">'dayofweek'</span><span class="p">,</span> <span class="s1">'day_sin'</span><span class="p">,</span> <span class="s1">'day_cos'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">,</span> <span class="s1">'season'</span><span class="p">,</span>
    <span class="c1"># Categorical</span>
    <span class="s1">'weather'</span><span class="p">,</span>
    <span class="c1"># Binary indicators</span>
    <span class="s1">'workingday'</span><span class="p">,</span> <span class="s1">'holiday'</span><span class="p">,</span> <span class="s1">'is_rush_hour'</span><span class="p">,</span> <span class="s1">'is_weekend'</span><span class="p">,</span> <span class="s1">'is_night'</span><span class="p">,</span>
    <span class="c1"># Lag features</span>
    <span class="s1">'demand_lag_1h'</span><span class="p">,</span> <span class="s1">'demand_lag_24h'</span>
<span class="p">]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">feature_columns</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Feature matrix: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> observations Ã— </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> features"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Features: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span><span class="si">}</span><span class="s2">... (and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="si">}</span><span class="s2"> more)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Target: count (hourly bike rentals)</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Chronological train-test split (80/20)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Chronological Train-Test Split ---"</span><span class="p">)</span>
<span class="n">split_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_clean</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>

<span class="n">train_period</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>
<span class="n">test_period</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Training set: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> observations (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Period: </span><span class="si">{</span><span class="n">train_period</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Testing set:  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> observations (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Period: </span><span class="si">{</span><span class="n">test_period</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Chronological order preserved - training on past, testing on future</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Train Linear Regression model</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Training Linear Regression ---"</span><span class="p">)</span>
<span class="n">linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">linear_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Linear model trained successfully!"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Coefficients learned: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span><span class="si">}</span><span class="s2"> parameters"</span><span class="p">)</span>

<span class="c1"># Show top 3 most influential features</span>
<span class="n">feature_importance_linear</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'feature'</span><span class="p">:</span> <span class="n">feature_columns</span><span class="p">,</span>
    <span class="s1">'coefficient'</span><span class="p">:</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span>
<span class="p">})</span>
<span class="n">feature_importance_linear</span><span class="p">[</span><span class="s1">'abs_coef'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">feature_importance_linear</span><span class="p">[</span><span class="s1">'coefficient'</span><span class="p">])</span>
<span class="n">top_features</span> <span class="o">=</span> <span class="n">feature_importance_linear</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'abs_coef'</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Top 3 most influential features:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_features</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'coefficient'</span><span class="p">]</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2"> (larger magnitude = stronger impact)"</span><span class="p">)</span>

<span class="c1"># Evaluate on test set</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Model Evaluation ---"</span><span class="p">)</span>
<span class="n">test_predictions_linear</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_r2_linear</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions_linear</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Test RÂ²: </span><span class="si">{</span><span class="n">test_r2_linear</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">test_r2_linear</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% variance explained)"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">test_r2_linear</span> <span class="o">&gt;</span> <span class="mf">0.80</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Excellent performance - model explains &gt;80</span><span class="si">% o</span><span class="s2">f demand variation"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">test_r2_linear</span> <span class="o">&gt;</span> <span class="mf">0.60</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Good performance - model captures major demand patterns"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">test_r2_linear</span> <span class="o">&gt;</span> <span class="mf">0.40</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"~ Moderate performance - room for improvement with advanced models"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âš  Limited performance - advanced models likely needed"</span><span class="p">)</span>

<span class="c1"># Show example predictions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Example Predictions (First 5 Test Observations) ---"</span><span class="p">)</span>
<span class="n">comparison</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Actual'</span><span class="p">:</span> <span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">'Predicted'</span><span class="p">:</span> <span class="n">test_predictions_linear</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>
    <span class="s1">'Error'</span><span class="p">:</span> <span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">test_predictions_linear</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">comparison</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Linear Regression baseline established: RÂ² = </span><span class="si">{</span><span class="n">test_r2_linear</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=551d3773"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <p><strong>What this does:</strong></p>
                    <ul>
                      <li
                        >Selects 17 engineered features for modeling (weather,
                        temporal, binary, lags)</li
                      >
                      <li
                        >Creates chronological 80/20 split preserving temporal
                        integrity for honest evaluation</li
                      >
                      <li
                        >Trains LinearRegression on historical data (first 80%
                        of timeline)</li
                      >
                      <li
                        >Evaluates on unseen future data (last 20% of timeline)
                        using RÂ² metric</li
                      >
                      <li
                        >Shows example predictions with errors to understand
                        model behavior</li
                      >
                    </ul>
                    <p
                      ><strong>Business value:</strong> Linear baseline provides
                      interpretable performance benchmark and reveals which
                      features have strongest linear relationships with demand.
                      RÂ² indicates how much demand variation the simple linear
                      model explains.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=c75552e2"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h3 id="Challenge-4:-Feature-Combination-Experiments"
                      >Challenge 4: Feature Combination Experiments<a
                        class="anchor-link"
                        href="#Challenge-4:-Feature-Combination-Experiments"
                      ></a></h3
                    ><p
                      >Your client asks: "Which feature types matter most -
                      weather or time? Can we get good performance with fewer
                      features?" Compare model performance using different
                      feature combinations.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=b828a6c2"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Your code here - compare feature combinations</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== FEATURE COMBINATION EXPERIMENTS ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Define three feature sets to compare</span>
<span class="n">weather_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'atemp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">]</span>
<span class="n">time_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">,</span> <span class="s1">'hour_cos'</span><span class="p">,</span> <span class="s1">'day_sin'</span><span class="p">,</span> <span class="s1">'day_cos'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">,</span> <span class="s1">'season'</span><span class="p">,</span>
                 <span class="s1">'is_rush_hour'</span><span class="p">,</span> <span class="s1">'is_weekend'</span><span class="p">,</span> <span class="s1">'is_night'</span><span class="p">]</span>
<span class="n">full_features</span> <span class="o">=</span> <span class="n">feature_columns</span>  <span class="c1"># All 20 features</span>

<span class="c1"># Train and evaluate models with each feature set</span>
<span class="n">feature_sets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Weather Only'</span><span class="p">:</span> <span class="n">weather_features</span><span class="p">,</span>
    <span class="s1">'Time Only'</span><span class="p">:</span> <span class="n">time_features</span><span class="p">,</span>
    <span class="s1">'Full Feature Set'</span><span class="p">:</span> <span class="n">full_features</span>
<span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">feature_sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># Train model</span>
    <span class="n">X_train_subset</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">_____</span><span class="p">]</span>
    <span class="n">X_test_subset</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">_____</span><span class="p">]</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">_____</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># Evaluate</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">_____</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">_____</span><span class="p">)</span>
    
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">'Feature Set'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s1">'Num Features'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">_____</span><span class="p">),</span>
        <span class="s1">'Test RÂ²'</span><span class="p">:</span> <span class="n">r2</span>
    <span class="p">})</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Test RÂ²: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">r2</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% variance explained)"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="c1"># Create comparison visualization</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Feature Set'</span><span class="p">],</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">],</span> 
               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">'skyblue'</span><span class="p">,</span> <span class="s1">'lightcoral'</span><span class="p">,</span> <span class="s1">'lightgreen'</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Test RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Set Performance Comparison'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add value labels</span>
<span class="k">for</span> <span class="n">bar</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> 
             <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Business insights</span>
<span class="n">best_set</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s1">'Feature Set'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">=== INSIGHTS ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Best performing set: </span><span class="si">{</span><span class="n">best_set</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Key finding: </span><span class="si">{</span><span class="s1">'Time'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s1">'Time'</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">best_set</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Weather'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="s1">'Weather'</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">best_set</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Combined'</span><span class="si">}</span><span class="s2"> features drive predictions"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=f9b454c2"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ’¡ <strong>Tip</strong> (click to expand)</summary
                      >
                      <p
                        >For each feature set, subset the training and testing
                        data using <code>X_train[features]</code> where features
                        is the list of column names. Train a fresh
                        LinearRegression() model for each subset - don't reuse
                        models! The pattern is: subset data â†’ create new model â†’
                        fit on subset training â†’ predict on subset testing â†’
                        calculate RÂ². Store results in a list of dictionaries
                        for easy comparison. Weather-only features test whether
                        environmental conditions alone can predict demand
                        (typically rÂ² ~0.15-0.25). Time-only features test
                        temporal patterns without weather (typically rÂ²
                        ~0.40-0.60). Full feature set combines both (typically
                        rÂ² ~0.65-0.80). The comparison reveals whether demand is
                        primarily driven by when people ride (temporal) or what
                        conditions encourage riding (weather). Business insight:
                        If time features dominate, invest in temporal fleet
                        positioning; if weather dominates, invest in
                        weather-responsive operations; if combination is best,
                        integrated strategy needed.</p
                      >
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=af8910f2"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ¤« <strong>Solution</strong> (click to expand)</summary
                      >
                      <div class="highlight">
                        <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"=== FEATURE COMBINATION EXPERIMENTS ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Define three feature sets</span>
<span class="n">weather_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'temp'</span><span class="p">,</span> <span class="s1">'atemp'</span><span class="p">,</span> <span class="s1">'humidity'</span><span class="p">,</span> <span class="s1">'windspeed'</span><span class="p">]</span>
<span class="n">time_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'hour_sin'</span><span class="p">,</span> <span class="s1">'hour_cos'</span><span class="p">,</span> <span class="s1">'day_sin'</span><span class="p">,</span> <span class="s1">'day_cos'</span><span class="p">,</span> <span class="s1">'month'</span><span class="p">,</span> <span class="s1">'season'</span><span class="p">,</span>
                 <span class="s1">'is_rush_hour'</span><span class="p">,</span> <span class="s1">'is_weekend'</span><span class="p">,</span> <span class="s1">'is_night'</span><span class="p">]</span>
<span class="n">full_features</span> <span class="o">=</span> <span class="n">feature_columns</span>

<span class="n">feature_sets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'Weather Only'</span><span class="p">:</span> <span class="n">weather_features</span><span class="p">,</span>
    <span class="s1">'Time Only'</span><span class="p">:</span> <span class="n">time_features</span><span class="p">,</span>
    <span class="s1">'Full Feature Set'</span><span class="p">:</span> <span class="n">full_features</span>
<span class="p">}</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">features</span> <span class="ow">in</span> <span class="n">feature_sets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="c1"># Train model with feature subset</span>
    <span class="n">X_train_subset</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
    <span class="n">X_test_subset</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_subset</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># Evaluate</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_subset</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">'Feature Set'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s1">'Num Features'</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span>
        <span class="s1">'Test RÂ²'</span><span class="p">:</span> <span class="n">r2</span>
    <span class="p">})</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">:"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Test RÂ²: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">r2</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% variance explained)"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="c1"># Visualization</span>
<span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">bars</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Feature Set'</span><span class="p">],</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">],</span> 
               <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">'skyblue'</span><span class="p">,</span> <span class="s1">'lightcoral'</span><span class="p">,</span> <span class="s1">'lightgreen'</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Test RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Set Performance Comparison'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">bar</span><span class="p">,</span> <span class="n">r2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> 
             <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Insights</span>
<span class="n">best_set</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Test RÂ²'</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s1">'Feature Set'</span><span class="p">]</span>
<span class="n">time_r2</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Feature Set'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'Time Only'</span><span class="p">][</span><span class="s1">'Test RÂ²'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">weather_r2</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Feature Set'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'Weather Only'</span><span class="p">][</span><span class="s1">'Test RÂ²'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"=== FEATURE SET INSIGHTS ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Best performing: </span><span class="si">{</span><span class="n">best_set</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Time features alone: </span><span class="si">{</span><span class="n">time_r2</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> explanatory power"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Weather features alone: </span><span class="si">{</span><span class="n">weather_r2</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2"> explanatory power"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Full set: </span><span class="si">{</span><span class="n">results_df</span><span class="p">[</span><span class="n">results_df</span><span class="p">[</span><span class="s1">'Feature Set'</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Full Feature Set'</span><span class="p">][</span><span class="s1">'Test RÂ²'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Key finding: </span><span class="si">{</span><span class="s1">'Temporal patterns dominate'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">time_r2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">weather_r2</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Weather conditions dominate'</span><span class="si">}</span><span class="s2"> bike demand"</span><span class="p">)</span>
</pre>
                      </div>
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=6627a8e9"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=dab965d1"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2 id="Step-5:-Random-Forest-Ensemble-Model"
                      >Step 5: Random Forest Ensemble Model<a
                        class="anchor-link"
                        href="#Step-5:-Random-Forest-Ensemble-Model"
                      ></a></h2
                    ><p
                      >Linear regression established our baseline. Now we deploy
                      ensemble methods to capture non-linear patterns and
                      feature interactions.
                      <strong>From the lecture "Tree-Based Models"</strong>,
                      Random Forest combines multiple decision trees to achieve
                      superior accuracy while reducing overfitting.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=346a85fb"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Import ensemble methods</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== STEP 5: RANDOM FOREST ENSEMBLE MODEL ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Train Random Forest (using same train-test split as Linear model)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Training Random Forest ---"</span><span class="p">)</span>
<span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>      <span class="c1"># 100 decision trees in the forest</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>          <span class="c1"># Limit depth to control overfitting</span>
    <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>  <span class="c1"># Minimum samples required to split a node</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>              <span class="c1"># Use all CPU cores</span>
<span class="p">)</span>

<span class="n">rf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Random Forest trained: </span><span class="si">{</span><span class="n">rf_model</span><span class="o">.</span><span class="n">n_estimators</span><span class="si">}</span><span class="s2"> trees"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Tree depth limit: </span><span class="si">{</span><span class="n">rf_model</span><span class="o">.</span><span class="n">max_depth</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Training completed on </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> observations</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Evaluate on test set</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Model Evaluation ---"</span><span class="p">)</span>
<span class="n">test_predictions_rf</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">test_r2_rf</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions_rf</span><span class="p">)</span>

<span class="c1"># Also evaluate on training set to check overfitting</span>
<span class="n">train_predictions_rf</span> <span class="o">=</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">train_r2_rf</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">train_predictions_rf</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Training RÂ²: </span><span class="si">{</span><span class="n">train_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">train_r2_rf</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% variance explained)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Testing RÂ²:  </span><span class="si">{</span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">test_r2_rf</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% variance explained)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Overfit gap: </span><span class="si">{</span><span class="n">train_r2_rf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="n">train_r2_rf</span> <span class="o">-</span> <span class="n">test_r2_rf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.10</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Excellent generalization - minimal overfitting"</span><span class="p">)</span>
<span class="k">elif</span> <span class="p">(</span><span class="n">train_r2_rf</span> <span class="o">-</span> <span class="n">test_r2_rf</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.20</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Good generalization - acceptable overfitting"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âš  Moderate overfitting - consider regularization"</span><span class="p">)</span>

<span class="c1"># Compare to Linear baseline</span>
<span class="n">improvement</span> <span class="o">=</span> <span class="p">((</span><span class="n">test_r2_rf</span> <span class="o">-</span> <span class="n">test_r2_linear</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_r2_linear</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Performance vs Linear Baseline ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Linear RÂ²:        </span><span class="si">{</span><span class="n">test_r2_linear</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Random Forest RÂ²: </span><span class="si">{</span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Improvement:      </span><span class="si">{</span><span class="n">improvement</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">improvement</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Significant improvement - Random Forest captures non-linear patterns"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">improvement</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Moderate improvement - ensemble methods add value"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"~ Marginal improvement - linear relationships dominate"</span><span class="p">)</span>

<span class="c1"># Show example predictions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Example Predictions (First 5 Test Observations) ---"</span><span class="p">)</span>
<span class="n">comparison_rf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Actual'</span><span class="p">:</span> <span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="s1">'Linear'</span><span class="p">:</span> <span class="n">test_predictions_linear</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>
    <span class="s1">'Random Forest'</span><span class="p">:</span> <span class="n">test_predictions_rf</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>
    <span class="s1">'RF Error'</span><span class="p">:</span> <span class="n">y_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">test_predictions_rf</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">comparison_rf</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=c505235e"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <p><strong>What this does:</strong></p>
                    <ul>
                      <li
                        >Trains RandomForestRegressor with 100 trees using same
                        train-test split as Linear model</li
                      >
                      <li
                        >Evaluates on test set with RÂ² metric for direct
                        comparison</li
                      >
                      <li
                        >Checks train-test gap to assess overfitting (should be
                        &lt;0.20 for good generalization)</li
                      >
                      <li
                        >Visualizes top 10 features with horizontal bar chart
                        for stakeholder communication</li
                      >
                    </ul>
                    <p
                      ><strong>Business value:</strong> Random Forest captures
                      non-linear relationships and feature interactions Linear
                      models miss. Feature importance guides strategic
                      investments - showing whether to prioritize temporal
                      optimization or weather-responsive operations.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=68da42b1"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h3 id="Challenge-5:-Deep-Feature-Importance-Analysis"
                      >Challenge 5: Deep Feature Importance Analysis<a
                        class="anchor-link"
                        href="#Challenge-5:-Deep-Feature-Importance-Analysis"
                      ></a></h3
                    ><p
                      >Your client asks: "Can you analyze the feature importance
                      patterns more deeply? I want to understand cumulative
                      importance and identify the minimal feature set that
                      retains most predictive power." Perform comprehensive
                      feature importance analysis.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=60416f59"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Create feature importance DataFrame from Random Forest model</span>
<span class="n">feature_importance_rf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'feature'</span><span class="p">:</span> <span class="n">feature_columns</span><span class="p">,</span>
    <span class="s1">'importance'</span><span class="p">:</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'importance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Calculate cumulative importance</span>
<span class="n">feature_importance_rf</span><span class="p">[</span><span class="s1">'cumulative'</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== CUMULATIVE IMPORTANCE ANALYSIS ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Find thresholds</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_rf</span><span class="p">)):</span>
    <span class="n">cumulative</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">'cumulative'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prev_cumulative</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'cumulative'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cumulative</span> <span class="o">&gt;=</span> <span class="mf">0.80</span> <span class="ow">and</span> <span class="n">prev_cumulative</span> <span class="o">&lt;</span> <span class="mf">0.80</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Top </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> features capture 80% of predictive power"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cumulative</span> <span class="o">&gt;=</span> <span class="mf">0.90</span> <span class="ow">and</span> <span class="n">prev_cumulative</span> <span class="o">&lt;</span> <span class="mf">0.90</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Top </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> features capture 90% of predictive power"</span><span class="p">)</span>

<span class="c1"># Visualizations</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Panel 1: Individual importance</span>
<span class="n">top_12</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">colors_importance</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_12</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12</span><span class="p">)),</span> <span class="n">top_12</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors_importance</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">top_12</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Importance Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Individual Feature Importance'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 2: Cumulative curve</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_rf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> 
             <span class="n">feature_importance_rf</span><span class="p">[</span><span class="s1">'cumulative'</span><span class="p">],</span> 
             <span class="s1">'o-'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'80%'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'90%'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Number of Top Features'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Cumulative Importance'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Cumulative Feature Contribution'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Test reduced model</span>
<span class="n">top_features_list</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">8</span><span class="p">)[</span><span class="s1">'feature'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">rf_reduced</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rf_reduced</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">top_features_list</span><span class="p">],</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">r2_reduced</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_reduced</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">top_features_list</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">=== REDUCED FEATURE SET TEST ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Full model (20 features):     RÂ² = </span><span class="si">{</span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reduced model (8 features):   RÂ² = </span><span class="si">{</span><span class="n">r2_reduced</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Performance retained:         </span><span class="si">{</span><span class="p">(</span><span class="n">r2_reduced</span><span class="o">/</span><span class="n">test_r2_rf</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Complexity reduction:         </span><span class="si">{</span><span class="p">((</span><span class="mi">20</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% fewer features"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Top 8 features: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_features_list</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'âœ“ Recommend reduced model for production'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">r2_reduced</span><span class="o">/</span><span class="n">test_r2_rf</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.95</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'âœ“ Recommend full model - all features provide value'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=6a0c0794"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ’¡ <strong>Tip</strong> (click to expand)</summary
                      >
                      <p
                        >First create the feature importance DataFrame from
                        <code>rf_model.feature_importances_</code> paired with
                        <code>feature_columns</code>:
                        <code
                          >pd.DataFrame({'feature': feature_columns,
                          'importance': rf_model.feature_importances_})</code
                        >. Sort by importance descending and reset the index.
                        Cumulative importance shows how much predictive power
                        accumulates as you add features ranked by importance.
                        Calculate with <code>.cumsum()</code> on the sorted
                        importance column. The cumulative curve typically shows
                        diminishing returns: top 3 features might capture 60%,
                        top 6 capture 80%, top 10 capture 90%. To find
                        thresholds, iterate through cumulative values checking
                        when they cross 0.80 and 0.90. For the reduced model
                        test, use the top N features list:
                        <code
                          >top_features_list =
                          feature_importance_rf.head(N)['feature'].tolist()</code
                        >, then subset X_train and X_test with this list. Train
                        a fresh Random Forest and compare its RÂ² to the full
                        model. Business question: Can we get 95%+ of performance
                        with 50% fewer features? If yes, the simplified model is
                        easier to maintain and deploy. If no, all features
                        justify their complexity. Practical rule: If top 8
                        features give you 95% of performance, drop the bottom 12
                        for production simplicity.</p
                      >
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=3aead668"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ¤« <strong>Solution</strong> (click to expand)</summary
                      >
                      <div class="highlight">
                        <pre><span></span><span class="c1"># Create feature importance DataFrame from Random Forest model</span>
<span class="n">feature_importance_rf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'feature'</span><span class="p">:</span> <span class="n">feature_columns</span><span class="p">,</span>
    <span class="s1">'importance'</span><span class="p">:</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'importance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Calculate cumulative importance</span>
<span class="n">feature_importance_rf</span><span class="p">[</span><span class="s1">'cumulative'</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== CUMULATIVE IMPORTANCE ANALYSIS ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Find thresholds</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_rf</span><span class="p">)):</span>
    <span class="n">cumulative</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">'cumulative'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prev_cumulative</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'cumulative'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cumulative</span> <span class="o">&gt;=</span> <span class="mf">0.80</span> <span class="ow">and</span> <span class="n">prev_cumulative</span> <span class="o">&lt;</span> <span class="mf">0.80</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Top </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> features capture 80% of predictive power"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cumulative</span> <span class="o">&gt;=</span> <span class="mf">0.90</span> <span class="ow">and</span> <span class="n">prev_cumulative</span> <span class="o">&lt;</span> <span class="mf">0.90</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Top </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> features capture 90% of predictive power"</span><span class="p">)</span>

<span class="c1"># Visualizations</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Panel 1: Individual importance</span>
<span class="n">top_12</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">colors_importance</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_12</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12</span><span class="p">)),</span> <span class="n">top_12</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors_importance</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">top_12</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Importance Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Individual Feature Importance'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 2: Cumulative curve</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">feature_importance_rf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> 
             <span class="n">feature_importance_rf</span><span class="p">[</span><span class="s1">'cumulative'</span><span class="p">],</span> 
             <span class="s1">'o-'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'80%'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'90%'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Number of Top Features'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Cumulative Importance'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Cumulative Feature Contribution'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Test reduced model</span>
<span class="n">top_features_list</span> <span class="o">=</span> <span class="n">feature_importance_rf</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">8</span><span class="p">)[</span><span class="s1">'feature'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">rf_reduced</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rf_reduced</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">top_features_list</span><span class="p">],</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">r2_reduced</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rf_reduced</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">[</span><span class="n">top_features_list</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">=== REDUCED FEATURE SET TEST ==="</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Full model (20 features):     RÂ² = </span><span class="si">{</span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reduced model (8 features):   RÂ² = </span><span class="si">{</span><span class="n">r2_reduced</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Performance retained:         </span><span class="si">{</span><span class="p">(</span><span class="n">r2_reduced</span><span class="o">/</span><span class="n">test_r2_rf</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Complexity reduction:         </span><span class="si">{</span><span class="p">((</span><span class="mi">20</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% fewer features"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Top 8 features: </span><span class="si">{</span><span class="s1">', '</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">top_features_list</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'âœ“ Recommend reduced model for production'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">r2_reduced</span><span class="o">/</span><span class="n">test_r2_rf</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.95</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'âœ“ Recommend full model - all features provide value'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre>
                      </div>
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=505aa2b2"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=fec41f3f"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2
                      id="Step-6:-Comprehensive-Model-Comparison-and-Deployment-Decision"
                      >Step 6: Comprehensive Model Comparison and Deployment
                      Decision<a
                        class="anchor-link"
                        href="#Step-6:-Comprehensive-Model-Comparison-and-Deployment-Decision"
                      ></a></h2
                    ><p
                      >We've trained both a Linear Regression baseline and a
                      Random Forest ensemble model. Now we face the critical
                      question:
                      <strong
                        >which model should we deploy to production?</strong
                      >
                      This decision requires more than comparing RÂ² scores from
                      a single train-test splitâ€”we need statistical confidence
                      that one model consistently outperforms the other across
                      different time periods.</p
                    >
                    <p
                      ><strong
                        >From the lecture "Model Evaluation &amp; Performance
                        Assessment"</strong
                      >, we learned that rigorous model selection requires: (1)
                      multiple evaluation metrics (MAE, RMSE, RÂ²), (2)
                      cross-validation for statistical confidence, and (3)
                      business impact translation. We implement this framework
                      using <strong>TimeSeriesSplit cross-validation</strong>,
                      which respects temporal ordering by training on historical
                      data and testing on future dataâ€”mimicking real-world
                      deployment where we predict tomorrow using yesterday's
                      patterns.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=8761b4b6"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Import comprehensive evaluation metrics</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimeSeriesSplit</span><span class="p">,</span> <span class="n">cross_val_score</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== STEP 6: COMPREHENSIVE MODEL COMPARISON ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Configure TimeSeriesSplit cross-validation with 5 folds</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"--- Cross-Validation Setup ---"</span><span class="p">)</span>
<span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Method: TimeSeriesSplit (respects temporal order)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Number of folds: 5"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Strategy: Expanding window (each fold trains on more historical data)</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Show fold structure for transparency</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Fold structure:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">fold</span><span class="p">,</span> <span class="p">(</span><span class="n">train_idx</span><span class="p">,</span> <span class="n">test_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tscv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">train_start</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">train_end</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">test_start</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    <span class="n">test_end</span> <span class="o">=</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]][</span><span class="s1">'datetime'</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Fold </span><span class="si">{</span><span class="n">fold</span><span class="si">}</span><span class="s2">: Train </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_idx</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> obs (</span><span class="si">{</span><span class="n">train_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">train_end</span><span class="si">}</span><span class="s2">) â†’ "</span>
          <span class="sa">f</span><span class="s2">"Test </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_idx</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> obs (</span><span class="si">{</span><span class="n">test_start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">test_end</span><span class="si">}</span><span class="s2">)"</span><span class="p">)</span>

<span class="c1"># Perform cross-validation for both models</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Running Cross-Validation for Both Models ---</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Linear Regression CV</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Linear Regression:"</span><span class="p">)</span>
<span class="n">linear_cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">tscv</span><span class="p">,</span> 
                                   <span class="n">scoring</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">fold</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">linear_cv_scores</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Fold </span><span class="si">{</span><span class="n">fold</span><span class="si">}</span><span class="s2">: RÂ² = </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">linear_cv_mean</span> <span class="o">=</span> <span class="n">linear_cv_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">linear_cv_std</span> <span class="o">=</span> <span class="n">linear_cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Mean: </span><span class="si">{</span><span class="n">linear_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">linear_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Random Forest CV</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Random Forest:"</span><span class="p">)</span>
<span class="n">rf_cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">tscv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">fold</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rf_cv_scores</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Fold </span><span class="si">{</span><span class="n">fold</span><span class="si">}</span><span class="s2">: RÂ² = </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">rf_cv_mean</span> <span class="o">=</span> <span class="n">rf_cv_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">rf_cv_std</span> <span class="o">=</span> <span class="n">rf_cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Mean: </span><span class="si">{</span><span class="n">rf_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">rf_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Statistical comparison</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Cross-Validation Statistical Comparison ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Linear Regression: </span><span class="si">{</span><span class="n">linear_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">linear_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Random Forest:     </span><span class="si">{</span><span class="n">rf_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">rf_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Difference:        </span><span class="si">{</span><span class="p">(</span><span class="n">rf_cv_mean</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linear_cv_mean</span><span class="p">)</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">rf_cv_mean</span> <span class="o">&gt;</span> <span class="n">linear_cv_mean</span><span class="p">:</span>
    <span class="n">improvement_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">rf_cv_mean</span> <span class="o">-</span> <span class="n">linear_cv_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">linear_cv_mean</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Random Forest superior: </span><span class="si">{</span><span class="n">improvement_pct</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">% better mean performance"</span><span class="p">)</span>
    <span class="n">winner</span> <span class="o">=</span> <span class="s2">"Random Forest"</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">improvement_pct</span> <span class="o">=</span> <span class="p">((</span><span class="n">linear_cv_mean</span> <span class="o">-</span> <span class="n">rf_cv_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">rf_cv_mean</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Linear Regression superior: </span><span class="si">{</span><span class="n">improvement_pct</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">% better mean performance"</span><span class="p">)</span>
    <span class="n">winner</span> <span class="o">=</span> <span class="s2">"Linear Regression"</span>

<span class="c1"># Calculate additional metrics on final test set</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Test Set Performance Metrics ---"</span><span class="p">)</span>

<span class="c1"># Use the test predictions from Step 4 and Step 5</span>
<span class="n">linear_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions_linear</span><span class="p">)</span>
<span class="n">linear_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions_linear</span><span class="p">))</span>
<span class="n">linear_r2</span> <span class="o">=</span> <span class="n">test_r2_linear</span>

<span class="n">rf_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions_rf</span><span class="p">)</span>
<span class="n">rf_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions_rf</span><span class="p">))</span>
<span class="n">rf_r2</span> <span class="o">=</span> <span class="n">test_r2_rf</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Linear Regression Test Set:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  MAE:  </span><span class="si">{</span><span class="n">linear_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> bikes/hour"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RMSE: </span><span class="si">{</span><span class="n">linear_rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> bikes/hour"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RÂ²:   </span><span class="si">{</span><span class="n">linear_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Forest Test Set:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  MAE:  </span><span class="si">{</span><span class="n">rf_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> bikes/hour"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RMSE: </span><span class="si">{</span><span class="n">rf_rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> bikes/hour"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  RÂ²:   </span><span class="si">{</span><span class="n">rf_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Create comprehensive comparison table</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"COMPREHENSIVE MODEL COMPARISON TABLE"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">comparison_metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'Metric'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'MAE (bikes/hour)'</span><span class="p">,</span> <span class="s1">'RMSE (bikes/hour)'</span><span class="p">,</span> <span class="s1">'RÂ² Score (test)'</span><span class="p">,</span> <span class="s1">'RÂ² Score (CV mean)'</span><span class="p">],</span>
    <span class="s1">'Linear Regression'</span><span class="p">:</span> <span class="p">[</span><span class="n">linear_mae</span><span class="p">,</span> <span class="n">linear_rmse</span><span class="p">,</span> <span class="n">linear_r2</span><span class="p">,</span> <span class="n">linear_cv_mean</span><span class="p">],</span>
    <span class="s1">'Random Forest'</span><span class="p">:</span> <span class="p">[</span><span class="n">rf_mae</span><span class="p">,</span> <span class="n">rf_rmse</span><span class="p">,</span> <span class="n">rf_r2</span><span class="p">,</span> <span class="n">rf_cv_mean</span><span class="p">],</span>
    <span class="s1">'Winner'</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'RF'</span> <span class="k">if</span> <span class="n">rf_mae</span> <span class="o">&lt;</span> <span class="n">linear_mae</span> <span class="k">else</span> <span class="s1">'Linear'</span><span class="p">,</span>
        <span class="s1">'RF'</span> <span class="k">if</span> <span class="n">rf_rmse</span> <span class="o">&lt;</span> <span class="n">linear_rmse</span> <span class="k">else</span> <span class="s1">'Linear'</span><span class="p">,</span>
        <span class="s1">'RF'</span> <span class="k">if</span> <span class="n">rf_r2</span> <span class="o">&gt;</span> <span class="n">linear_r2</span> <span class="k">else</span> <span class="s1">'Linear'</span><span class="p">,</span>
        <span class="s1">'RF'</span> <span class="k">if</span> <span class="n">rf_cv_mean</span> <span class="o">&gt;</span> <span class="n">linear_cv_mean</span> <span class="k">else</span> <span class="s1">'Linear'</span>
    <span class="p">]</span>
<span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">comparison_metrics</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Summary of wins</span>
<span class="n">rf_wins</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rf_mae</span> <span class="o">&lt;</span> <span class="n">linear_mae</span><span class="p">,</span> <span class="n">rf_rmse</span> <span class="o">&lt;</span> <span class="n">linear_rmse</span><span class="p">,</span> <span class="n">rf_r2</span> <span class="o">&gt;</span> <span class="n">linear_r2</span><span class="p">,</span> <span class="n">rf_cv_mean</span> <span class="o">&gt;</span> <span class="n">linear_cv_mean</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="n">winner</span><span class="si">}</span><span class="s2"> wins </span><span class="si">{</span><span class="n">rf_wins</span><span class="si">}</span><span class="s2">/4 metrics"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'='</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Visualize comprehensive comparison</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">'Comprehensive Model Comparison'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>

<span class="c1"># Panel 1: Cross-validation fold-by-fold performance</span>
<span class="n">fold_numbers</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_numbers</span><span class="p">,</span> <span class="n">linear_cv_scores</span><span class="p">,</span> <span class="s1">'o-'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Linear Regression'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fold_numbers</span><span class="p">,</span> <span class="n">rf_cv_scores</span><span class="p">,</span> <span class="s1">'s-'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Random Forest'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">linear_cv_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">rf_cv_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Fold Number'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Cross-Validation Performance by Fold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>  <span class="c1"># Force integer fold numbers only</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 2: Cross-validation stability (box plot)</span>
<span class="n">bp</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">boxplot</span><span class="p">([</span><span class="n">linear_cv_scores</span><span class="p">,</span> <span class="n">rf_cv_scores</span><span class="p">],</span> 
                         <span class="n">tick_labels</span><span class="o">=</span><span class="p">[</span><span class="s1">'Linear'</span><span class="p">,</span> <span class="s1">'Random Forest'</span><span class="p">],</span>
                         <span class="n">patch_artist</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">boxprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">),</span>
                         <span class="n">medianprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                         <span class="n">meanprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">'D'</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">'gold'</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="n">bp</span><span class="p">[</span><span class="s1">'boxes'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">'lightblue'</span><span class="p">)</span>
<span class="n">bp</span><span class="p">[</span><span class="s1">'boxes'</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">'lightgreen'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Performance Distribution (Stability)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Panel 3: Test set metrics comparison (MAE and RMSE only)</span>
<span class="n">metrics_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'MAE</span><span class="se">\n</span><span class="s1">(lower better)'</span><span class="p">,</span> <span class="s1">'RMSE</span><span class="se">\n</span><span class="s1">(lower better)'</span><span class="p">]</span>
<span class="n">linear_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_mae</span><span class="p">,</span> <span class="n">linear_rmse</span><span class="p">]</span>
<span class="n">rf_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf_mae</span><span class="p">,</span> <span class="n">rf_rmse</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="n">bars1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">linear_metrics</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Linear'</span><span class="p">,</span> 
                       <span class="n">color</span><span class="o">=</span><span class="s1">'lightblue'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">bars2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rf_metrics</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Random Forest'</span><span class="p">,</span> 
                       <span class="n">color</span><span class="o">=</span><span class="s1">'lightgreen'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Metric Value (bikes/hour)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Test Set Error Metrics'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">metrics_names</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add value labels</span>
<span class="k">for</span> <span class="n">bars</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bars1</span><span class="p">,</span> <span class="n">bars2</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                       <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">height</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">'bottom'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="c1"># Panel 4: RÂ² Score Comparison (Test Set and CV Mean)</span>
<span class="n">r2_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Test Set RÂ²</span><span class="se">\n</span><span class="s1">(higher better)'</span><span class="p">,</span> <span class="s1">'CV Mean RÂ²</span><span class="se">\n</span><span class="s1">(higher better)'</span><span class="p">]</span>
<span class="n">linear_r2_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_r2</span><span class="p">,</span> <span class="n">linear_cv_mean</span><span class="p">]</span>
<span class="n">rf_r2_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf_r2</span><span class="p">,</span> <span class="n">rf_cv_mean</span><span class="p">]</span>

<span class="n">x_r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r2_categories</span><span class="p">))</span>
<span class="n">width_r2</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="n">bars_lin</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_r2</span> <span class="o">-</span> <span class="n">width_r2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">linear_r2_values</span><span class="p">,</span> <span class="n">width_r2</span><span class="p">,</span> 
                          <span class="n">label</span><span class="o">=</span><span class="s1">'Linear'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'lightblue'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">bars_rf</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x_r2</span> <span class="o">+</span> <span class="n">width_r2</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rf_r2_values</span><span class="p">,</span> <span class="n">width_r2</span><span class="p">,</span> 
                         <span class="n">label</span><span class="o">=</span><span class="s1">'Random Forest'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'lightgreen'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'RÂ² Score Comparison'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_r2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">r2_categories</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add value labels</span>
<span class="k">for</span> <span class="n">bars</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bars_lin</span><span class="p">,</span> <span class="n">bars_rf</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">bars</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span>
                       <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">height</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">'bottom'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=6d1ae154"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <p><strong>What this does:</strong></p>
                    <ul>
                      <li
                        >Uses
                        <strong
                          >TimeSeriesSplit cross-validation as the primary
                          evaluation method</strong
                        >
                        (not an afterthought)</li
                      >
                      <li
                        >Shows fold structure with date ranges for transparency
                        (5 expanding windows)</li
                      >
                      <li
                        >Prints fold-by-fold RÂ² scores for both Linear
                        Regression AND Random Forest</li
                      >
                      <li
                        >Calculates CV mean and std for statistical
                        confidence</li
                      >
                      <li
                        >Computes test set metrics (MAE, RMSE, RÂ²) for both
                        models</li
                      >
                      <li
                        ><strong>Creates comprehensive comparison table</strong>
                        showing all 4 metrics (MAE, RMSE, test RÂ², CV mean RÂ²)
                        with winner declared for each</li
                      >
                      <li
                        >Visualizes performance with 4-panel dashboard:<ul>
                          <li
                            ><strong>Panel 1</strong>: CV fold-by-fold
                            performance (line plot showing RÂ² across 5
                            folds)</li
                          >
                          <li
                            ><strong>Panel 2</strong>: CV stability (box plot
                            showing distribution and outliers)</li
                          >
                          <li
                            ><strong>Panel 3</strong>: Test set error metrics
                            (MAE and RMSE in bikes/hour - same scale)</li
                          >
                          <li
                            ><strong>Panel 4</strong>: RÂ² score comparison (Test
                            Set RÂ² and CV Mean RÂ² on 0-1 scale)</li
                          >
                        </ul>
                      </li>
                      <li
                        >Shows clear summary: which model wins on how many
                        metrics</li
                      >
                    </ul>
                    <p
                      ><strong>Business value:</strong> Cross-validation
                      provides statistical confidence across multiple time
                      periods, not just one arbitrary train-test split. The
                      comprehensive comparison table gives stakeholders a clear,
                      at-a-glance view of model performance across all key
                      metrics. This rigorous approach demonstrates which model
                      will generalize better to future unseen data.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=724b17b1"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h3
                      id="Challenge-6:-Enhanced-Model-with-Rolling-Window-Features"
                      >Challenge 6: Enhanced Model with Rolling Window
                      Features<a
                        class="anchor-link"
                        href="#Challenge-6:-Enhanced-Model-with-Rolling-Window-Features"
                      ></a></h3
                    ><p
                      >Your client asks: "We engineered those rolling window
                      features in Challenge 2 - do they actually improve our
                      models? I want to see if the extra complexity is worth
                      it." Add the rolling features to both models and compare
                      baseline vs enhanced performance.</p
                    >
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing code_cell rendered"
                id="cell-id=adb20a12"
              >
                <div class="input">
                  <div class="prompt input_prompt">InÂ [Â ]:</div>
                  <div class="inner_cell">
                    <div class="input_area">
                      <div class="highlight hl-ipython3">
                        <pre><span></span><span class="c1"># Your code here - retrain models with rolling window features and compare</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"=== ENHANCED MODEL WITH ROLLING WINDOW FEATURES ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># First, create rolling window features if not already present</span>
<span class="k">if</span> <span class="s1">'demand_3h_avg'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Rolling window features created"</span><span class="p">)</span>

<span class="c1"># Handle NaN values (whether features were just created or from Challenge 2)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ NaN values handled in rolling features"</span><span class="p">)</span>

<span class="c1"># Expand feature set to include rolling features</span>
<span class="n">enhanced_features</span> <span class="o">=</span> <span class="n">feature_columns</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Baseline features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Enhanced features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enhanced_features</span><span class="p">)</span><span class="si">}</span><span class="s2"> (+2 rolling features)</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">X_enhanced</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">_____</span><span class="p">]</span>
<span class="n">y_enhanced</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span>

<span class="c1"># Cross-validation comparison</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Cross-Validation: Baseline vs Enhanced ---"</span><span class="p">)</span>

<span class="c1"># Linear Regression CV - Enhanced</span>
<span class="n">linear_enh_cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
    <span class="n">LinearRegression</span><span class="p">(),</span> 
    <span class="n">_____</span><span class="p">,</span> <span class="n">y_enhanced</span><span class="p">,</span> 
    <span class="n">cv</span><span class="o">=</span><span class="n">_____</span><span class="p">,</span> 
    <span class="n">scoring</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">,</span> 
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">linear_enh_cv_mean</span> <span class="o">=</span> <span class="n">linear_enh_cv_scores</span><span class="o">.</span><span class="n">_____</span><span class="p">()</span>

<span class="c1"># Random Forest CV - Enhanced  </span>
<span class="n">rf_enh_cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">_____</span><span class="p">,</span> <span class="n">y_enhanced</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">_____</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">rf_enh_cv_mean</span> <span class="o">=</span> <span class="n">rf_enh_cv_scores</span><span class="o">.</span><span class="n">_____</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Linear Regression CV:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline (20 features):  </span><span class="si">{</span><span class="n">linear_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">linear_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced (22 features):  </span><span class="si">{</span><span class="n">linear_enh_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">linear_enh_cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Change: </span><span class="si">{</span><span class="p">(</span><span class="n">linear_enh_cv_mean</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linear_cv_mean</span><span class="p">)</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Forest CV:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline (20 features):  </span><span class="si">{</span><span class="n">rf_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">rf_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced (22 features):  </span><span class="si">{</span><span class="n">rf_enh_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">rf_enh_cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Change: </span><span class="si">{</span><span class="p">(</span><span class="n">rf_enh_cv_mean</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rf_cv_mean</span><span class="p">)</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Test set evaluation (for detailed metrics and visualizations)</span>
<span class="n">X_train_enh</span> <span class="o">=</span> <span class="n">X_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
<span class="n">X_test_enh</span> <span class="o">=</span> <span class="n">X_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>
<span class="n">y_train_enh</span> <span class="o">=</span> <span class="n">y_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
<span class="n">y_test_enh</span> <span class="o">=</span> <span class="n">y_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>

<span class="c1"># Train on full training set for test predictions</span>
<span class="n">linear_enhanced</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">linear_enhanced</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">)</span>
<span class="n">linear_enh_pred</span> <span class="o">=</span> <span class="n">linear_enhanced</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">_____</span><span class="p">)</span>
<span class="n">linear_enh_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">)</span>
<span class="n">linear_enh_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_enh</span><span class="p">,</span> <span class="n">linear_enh_pred</span><span class="p">)</span>

<span class="n">rf_enhanced</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rf_enhanced</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">)</span>
<span class="n">rf_enh_pred</span> <span class="o">=</span> <span class="n">rf_enhanced</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">_____</span><span class="p">)</span>
<span class="n">rf_enh_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">_____</span><span class="p">,</span> <span class="n">_____</span><span class="p">)</span>
<span class="n">rf_enh_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_enh</span><span class="p">,</span> <span class="n">rf_enh_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Test Set Detailed Metrics ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Linear Regression:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline:  RÂ² = </span><span class="si">{</span><span class="n">test_r2_linear</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">linear_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced:  RÂ² = </span><span class="si">{</span><span class="n">linear_enh_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">linear_enh_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Forest:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline:  RÂ² = </span><span class="si">{</span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">rf_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced:  RÂ² = </span><span class="si">{</span><span class="n">rf_enh_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">rf_enh_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Feature importance for rolling features</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- ROLLING FEATURE IMPORTANCE (Enhanced RF Model) ---"</span><span class="p">)</span>
<span class="n">rf_enh_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'feature'</span><span class="p">:</span> <span class="n">enhanced_features</span><span class="p">,</span>
    <span class="s1">'importance'</span><span class="p">:</span> <span class="n">rf_enhanced</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'importance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">rolling_features_imp</span> <span class="o">=</span> <span class="n">rf_enh_importance</span><span class="p">[</span><span class="n">rf_enh_importance</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]</span>
<span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rolling_features_imp</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Visualize comparison</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Panel 1: CV Performance Comparison</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Linear</span><span class="se">\n</span><span class="s1">Baseline'</span><span class="p">,</span> <span class="s1">'Linear</span><span class="se">\n</span><span class="s1">Enhanced'</span><span class="p">,</span> <span class="s1">'RF</span><span class="se">\n</span><span class="s1">Baseline'</span><span class="p">,</span> <span class="s1">'RF</span><span class="se">\n</span><span class="s1">Enhanced'</span><span class="p">]</span>
<span class="n">cv_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_cv_mean</span><span class="p">,</span> <span class="n">linear_enh_cv_mean</span><span class="p">,</span> <span class="n">rf_cv_mean</span><span class="p">,</span> <span class="n">rf_enh_cv_mean</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'lightblue'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'lightgreen'</span><span class="p">,</span> <span class="s1">'darkgreen'</span><span class="p">]</span>

<span class="n">bars</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">cv_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'CV Mean RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Baseline vs Enhanced (Cross-Validation)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add value labels</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">cv_scores</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">score</span> <span class="o">+</span> <span class="mf">0.02</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Panel 2: Feature importance - Top 12 with rolling features highlighted</span>
<span class="n">top_12_enh</span> <span class="o">=</span> <span class="n">rf_enh_importance</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">highlight_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'gold'</span> <span class="k">if</span> <span class="n">feat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]</span> 
                    <span class="k">else</span> <span class="s1">'steelblue'</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]]</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">)),</span> <span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">],</span> 
             <span class="n">color</span><span class="o">=</span><span class="n">highlight_colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Importance Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Top 12 Features (Rolling Window in Gold)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Decision recommendation based on CV results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"="</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="n">max_cv_improvement</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">linear_enh_cv_mean</span> <span class="o">-</span> <span class="n">linear_cv_mean</span><span class="p">,</span> <span class="n">rf_enh_cv_mean</span> <span class="o">-</span> <span class="n">rf_cv_mean</span><span class="p">)</span>
<span class="k">if</span> <span class="n">max_cv_improvement</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ RECOMMENDATION: Deploy enhanced models - rolling features provide meaningful improvement"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">max_cv_improvement</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"~ RECOMMENDATION: Rolling features provide marginal benefit - deployment decision depends on complexity tolerance"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ— RECOMMENDATION: Use baseline models - rolling features add complexity without significant value"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=1003430d"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ’¡ <strong>Tip</strong> (click to expand)</summary
                      >
                      <p
                        >Build the enhanced feature set:
                        <code
                          >enhanced_features = feature_columns +
                          ['demand_3h_avg', 'demand_24h_avg']</code
                        >. Create X_enhanced using this list. Following Step 6's
                        rigorous methodology, use
                        <code>cross_val_score()</code> with the
                        <code>tscv</code> TimeSeriesSplit object to evaluate
                        enhanced models:
                        <code
                          >cross_val_score(LinearRegression(), X_enhanced,
                          y_enhanced, cv=tscv, scoring='r2')</code
                        >. This gives you 5 fold scores for the enhanced model.
                        Compare the CV means:
                        <code>linear_enh_cv_scores.mean()</code> vs
                        <code>linear_cv_mean</code> from Step 6. The blanks
                        require: <code>X_enhanced</code> for the feature matrix,
                        <code>tscv</code> for the cv parameter (reusing the
                        TimeSeriesSplit from Step 6), and
                        <code>.mean()</code> to get the average across folds.
                        Also run test set evaluation for detailed metrics (MAE)
                        and feature importance analysis - this requires the
                        train-test split. Train fresh models:
                        <code>LinearRegression()</code> and
                        <code>RandomForestRegressor()</code> with identical
                        hyperparameters. The test set blanks need:
                        <code>X_train_enh, y_train_enh</code> for fitting,
                        <code>X_test_enh</code> for prediction, and
                        <code>y_test_enh, linear_enh_pred</code> for RÂ² scoring.
                        Fill NaN values in rolling features BEFORE creating
                        X_enhanced to prevent "Input contains NaN" errors.
                        Expected realistic results: Linear CV improvement
                        0.00-0.03, Random Forest improvement 0.00-0.02. The
                        3-hour rolling average captures short-term trends while
                        the 24-hour rolling average provides daily baseline
                        patterns - both help models understand demand
                        trajectories beyond single lag values. Key insight:
                        Linear models typically benefit MORE from rolling
                        features (capturing sequential patterns they can't
                        model), while Random Forest shows smaller gains (trees
                        already capture patterns via existing lag features). Use
                        CV mean improvement (not single test score) for the
                        deployment decision - this is statistically robust. Rule
                        of thumb: CV improvement &gt;0.02 RÂ² is meaningful,
                        0.01-0.02 is marginal, &lt;0.01 suggests feature
                        redundancy.</p
                      >
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=8af6f469"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <details>
                      <summary
                        >ðŸ¤« <strong>Solution</strong> (click to expand)</summary
                      >
                      <div class="highlight">
                        <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"=== ENHANCED MODEL WITH ROLLING WINDOW FEATURES ===</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># First, create rolling window features if not already present</span>
<span class="k">if</span> <span class="s1">'demand_3h_avg'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_clean</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ Rolling window features created"</span><span class="p">)</span>

<span class="c1"># Handle NaN values (whether features were just created or from Challenge 2)</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'demand_24h_avg'</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ NaN values handled in rolling features"</span><span class="p">)</span>

<span class="c1"># Expand feature set to include rolling features</span>
<span class="n">enhanced_features</span> <span class="o">=</span> <span class="n">feature_columns</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Baseline features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">feature_columns</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Enhanced features: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">enhanced_features</span><span class="p">)</span><span class="si">}</span><span class="s2"> (+2 rolling features)</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">X_enhanced</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="n">enhanced_features</span><span class="p">]</span>
<span class="n">y_enhanced</span> <span class="o">=</span> <span class="n">df_clean</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span>

<span class="c1"># Cross-validation comparison</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Cross-Validation: Baseline vs Enhanced ---"</span><span class="p">)</span>

<span class="c1"># Linear Regression CV - Enhanced</span>
<span class="n">linear_enh_cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
    <span class="n">LinearRegression</span><span class="p">(),</span> 
    <span class="n">X_enhanced</span><span class="p">,</span> <span class="n">y_enhanced</span><span class="p">,</span> 
    <span class="n">cv</span><span class="o">=</span><span class="n">tscv</span><span class="p">,</span> 
    <span class="n">scoring</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">,</span> 
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">linear_enh_cv_mean</span> <span class="o">=</span> <span class="n">linear_enh_cv_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Random Forest CV - Enhanced  </span>
<span class="n">rf_enh_cv_scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span>
    <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">X_enhanced</span><span class="p">,</span> <span class="n">y_enhanced</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">tscv</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s1">'r2'</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">rf_enh_cv_mean</span> <span class="o">=</span> <span class="n">rf_enh_cv_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Linear Regression CV:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline (20 features):  </span><span class="si">{</span><span class="n">linear_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">linear_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced (22 features):  </span><span class="si">{</span><span class="n">linear_enh_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">linear_enh_cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">lin_cv_change</span> <span class="o">=</span> <span class="n">linear_enh_cv_mean</span> <span class="o">-</span> <span class="n">linear_cv_mean</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Change: </span><span class="si">{</span><span class="n">lin_cv_change</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="p">(</span><span class="n">lin_cv_change</span><span class="o">/</span><span class="n">linear_cv_mean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Forest CV:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline (20 features):  </span><span class="si">{</span><span class="n">rf_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">rf_cv_std</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced (22 features):  </span><span class="si">{</span><span class="n">rf_enh_cv_mean</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> Â± </span><span class="si">{</span><span class="n">rf_enh_cv_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">rf_cv_change</span> <span class="o">=</span> <span class="n">rf_enh_cv_mean</span> <span class="o">-</span> <span class="n">rf_cv_mean</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Change: </span><span class="si">{</span><span class="n">rf_cv_change</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="p">(</span><span class="n">rf_cv_change</span><span class="o">/</span><span class="n">rf_cv_mean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">%)"</span><span class="p">)</span>

<span class="c1"># Test set evaluation (for detailed metrics and visualizations)</span>
<span class="n">X_train_enh</span> <span class="o">=</span> <span class="n">X_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
<span class="n">X_test_enh</span> <span class="o">=</span> <span class="n">X_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>
<span class="n">y_train_enh</span> <span class="o">=</span> <span class="n">y_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_index</span><span class="p">]</span>
<span class="n">y_test_enh</span> <span class="o">=</span> <span class="n">y_enhanced</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_index</span><span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Training Final Models for Test Set Evaluation ---"</span><span class="p">)</span>

<span class="c1"># Train on full training set for test predictions</span>
<span class="n">linear_enhanced</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">linear_enhanced</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_enh</span><span class="p">,</span> <span class="n">y_train_enh</span><span class="p">)</span>
<span class="n">linear_enh_pred</span> <span class="o">=</span> <span class="n">linear_enhanced</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_enh</span><span class="p">)</span>
<span class="n">linear_enh_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test_enh</span><span class="p">,</span> <span class="n">linear_enh_pred</span><span class="p">)</span>
<span class="n">linear_enh_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_enh</span><span class="p">,</span> <span class="n">linear_enh_pred</span><span class="p">)</span>

<span class="n">rf_enhanced</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rf_enhanced</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_enh</span><span class="p">,</span> <span class="n">y_train_enh</span><span class="p">)</span>
<span class="n">rf_enh_pred</span> <span class="o">=</span> <span class="n">rf_enhanced</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_enh</span><span class="p">)</span>
<span class="n">rf_enh_r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test_enh</span><span class="p">,</span> <span class="n">rf_enh_pred</span><span class="p">)</span>
<span class="n">rf_enh_mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test_enh</span><span class="p">,</span> <span class="n">rf_enh_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- Test Set Detailed Metrics ---"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Linear Regression:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline:  RÂ² = </span><span class="si">{</span><span class="n">test_r2_linear</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">linear_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced:  RÂ² = </span><span class="si">{</span><span class="n">linear_enh_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">linear_enh_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Change: RÂ² </span><span class="si">{</span><span class="p">(</span><span class="n">linear_enh_r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">test_r2_linear</span><span class="p">)</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">, MAE </span><span class="si">{</span><span class="p">(</span><span class="n">linear_enh_mae</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">linear_mae</span><span class="p">)</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Random Forest:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Baseline:  RÂ² = </span><span class="si">{</span><span class="n">test_r2_rf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">rf_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Enhanced:  RÂ² = </span><span class="si">{</span><span class="n">rf_enh_r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, MAE = </span><span class="si">{</span><span class="n">rf_enh_mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Change: RÂ² </span><span class="si">{</span><span class="p">(</span><span class="n">rf_enh_r2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">test_r2_rf</span><span class="p">)</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2">, MAE </span><span class="si">{</span><span class="p">(</span><span class="n">rf_enh_mae</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rf_mae</span><span class="p">)</span><span class="si">:</span><span class="s2">+.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Feature importance analysis</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">--- ROLLING FEATURE IMPORTANCE (Enhanced RF Model) ---"</span><span class="p">)</span>
<span class="n">rf_enh_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">'feature'</span><span class="p">:</span> <span class="n">enhanced_features</span><span class="p">,</span>
    <span class="s1">'importance'</span><span class="p">:</span> <span class="n">rf_enhanced</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'importance'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Show rolling features specifically with their ranks</span>
<span class="n">rolling_features_imp</span> <span class="o">=</span> <span class="n">rf_enh_importance</span><span class="p">[</span><span class="n">rf_enh_importance</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]</span>
<span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rolling_features_imp</span><span class="p">[</span><span class="s1">'rank'</span><span class="p">]</span> <span class="o">=</span> <span class="n">rolling_features_imp</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">rf_enh_importance</span><span class="p">[</span><span class="n">rf_enh_importance</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rolling_features_imp</span><span class="p">[[</span><span class="s1">'feature'</span><span class="p">,</span> <span class="s1">'importance'</span><span class="p">,</span> <span class="s1">'rank'</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Visualizations</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Panel 1: CV Performance Comparison (primary evaluation)</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Linear</span><span class="se">\n</span><span class="s1">Baseline'</span><span class="p">,</span> <span class="s1">'Linear</span><span class="se">\n</span><span class="s1">Enhanced'</span><span class="p">,</span> <span class="s1">'RF</span><span class="se">\n</span><span class="s1">Baseline'</span><span class="p">,</span> <span class="s1">'RF</span><span class="se">\n</span><span class="s1">Enhanced'</span><span class="p">]</span>
<span class="n">cv_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">linear_cv_mean</span><span class="p">,</span> <span class="n">linear_enh_cv_mean</span><span class="p">,</span> <span class="n">rf_cv_mean</span><span class="p">,</span> <span class="n">rf_enh_cv_mean</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'lightblue'</span><span class="p">,</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'lightgreen'</span><span class="p">,</span> <span class="s1">'darkgreen'</span><span class="p">]</span>

<span class="n">bars</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">cv_scores</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'CV Mean RÂ² Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Baseline vs Enhanced (Cross-Validation)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add value labels</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="n">cv_scores</span><span class="p">)):</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">score</span> <span class="o">+</span> <span class="mf">0.02</span><span class="p">,</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Panel 2: Feature importance with rolling features highlighted</span>
<span class="n">top_12_enh</span> <span class="o">=</span> <span class="n">rf_enh_importance</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">highlight_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'gold'</span> <span class="k">if</span> <span class="n">feat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]</span> 
                    <span class="k">else</span> <span class="s1">'steelblue'</span> <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]]</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">)),</span> <span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">],</span> 
             <span class="n">color</span><span class="o">=</span><span class="n">highlight_colors</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">)))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'Importance Score'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Top 12 Features (Rolling Window in Gold)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'x'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add importance values for rolling features</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_12_enh</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">]:</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_12_enh</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">])</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">'feature'</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">],</span> <span class="n">rank</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"  </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'importance'</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> 
                    <span class="n">va</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Decision framework based on CV results (rigorous approach)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">+</span> <span class="s2">"="</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
<span class="n">max_cv_improvement</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lin_cv_change</span><span class="p">,</span> <span class="n">rf_cv_change</span><span class="p">)</span>
<span class="k">if</span> <span class="n">max_cv_improvement</span> <span class="o">&gt;</span> <span class="mf">0.02</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ“ RECOMMENDATION: Deploy enhanced models"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Rolling features provide meaningful improvement (</span><span class="si">{</span><span class="n">max_cv_improvement</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2"> CV RÂ²)"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  </span><span class="si">{</span><span class="s1">'Linear benefits most'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">lin_cv_change</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">rf_cv_change</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'Random Forest benefits most'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">max_cv_improvement</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"~ RECOMMENDATION: Consider enhanced models"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Rolling features provide marginal benefit (</span><span class="si">{</span><span class="n">max_cv_improvement</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2"> CV RÂ²)"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Deploy if operational complexity is acceptable"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"âœ— RECOMMENDATION: Use baseline models"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Rolling features add minimal value (</span><span class="si">{</span><span class="n">max_cv_improvement</span><span class="si">:</span><span class="s2">+.4f</span><span class="si">}</span><span class="s2"> CV RÂ²)"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Existing lag features already capture sequential patterns effectively"</span><span class="p">)</span>

<span class="c1"># Key insights</span>
<span class="n">rolling_in_top_5</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">feat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rf_enh_importance</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)[</span><span class="s1">'feature'</span><span class="p">])</span> 
                       <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'demand_3h_avg'</span><span class="p">,</span> <span class="s1">'demand_24h_avg'</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">âœ“ Rolling window features </span><span class="si">{</span><span class="s1">'ARE'</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">rolling_in_top_5</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">'are NOT'</span><span class="si">}</span><span class="s2"> in top 5 importance"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Linear CV improved by </span><span class="si">{</span><span class="p">(</span><span class="n">lin_cv_change</span><span class="o">/</span><span class="n">linear_cv_mean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">% (linear models benefit from sequential features)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Random Forest CV improved by </span><span class="si">{</span><span class="p">(</span><span class="n">rf_cv_change</span><span class="o">/</span><span class="n">rf_cv_mean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">+.1f</span><span class="si">}</span><span class="s2">% (trees already capture patterns)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"âœ“ Decision based on CV performance (statistically robust across 5 time periods)"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"="</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
</pre>
                      </div>
                    </details>
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=1b736784"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <hr />
                  </div>
                </div>
              </div>
              <div
                class="cell border-box-sizing text_cell rendered"
                id="cell-id=2c15266d"
                ><div class="prompt input_prompt"> </div
                ><div class="inner_cell">
                  <div class="text_cell_render border-box-sizing rendered_html">
                    <h2
                      id="Summary:-Complete-End-to-End-Machine-Learning-Pipeline-Mastery"
                      >Summary: Complete End-to-End Machine Learning Pipeline
                      Mastery<a
                        class="anchor-link"
                        href="#Summary:-Complete-End-to-End-Machine-Learning-Pipeline-Mastery"
                      ></a></h2
                    ><p><strong>What We've Accomplished</strong>:</p>
                    <ul>
                      <li
                        ><strong>Data Quality Pipeline</strong>: Implemented
                        systematic validation workflows, handled missing values,
                        verified timeline integrity, and established clean data
                        foundation for reliable modeling</li
                      >
                      <li
                        ><strong>Feature Engineering</strong>: Created 17
                        optimized features including categorical encodings,
                        scaled weather variables, cyclical temporal features,
                        and lag variables - transforming raw data into ML-ready
                        inputs</li
                      >
                      <li
                        ><strong>Statistical Validation</strong>: Applied
                        descriptive statistics, correlation analysis, and
                        professional visualizations (line plots, bar charts,
                        scatter plots, box plots, heatmaps) confirming features
                        capture real demand patterns</li
                      >
                      <li
                        ><strong>Linear Regression Baseline</strong>: Trained
                        interpretable baseline model achieving RÂ² â‰ˆ 0.80,
                        established performance benchmark, and validated
                        temporal train-test splitting methodology</li
                      >
                      <li
                        ><strong>Random Forest Excellence</strong>: Deployed
                        ensemble model with 100 trees achieving RÂ² â‰ˆ 0.90,
                        analyzed feature importance revealing key demand
                        drivers, and demonstrated non-linear pattern capture</li
                      >
                      <li
                        ><strong>Evaluation Framework</strong>: Compared models
                        across MAE, RMSE, and RÂ² metrics; applied 5-fold
                        TimeSeriesSplit cross-validation for robust estimates;
                        translated performance to business impact; made
                        evidence-based deployment recommendation</li
                      >
                    </ul>
                    <p><strong>Key Technical Skills Mastered</strong>:</p>
                    <ul>
                      <li
                        ><strong>Data preparation</strong>: Quality assessment
                        workflows, missing data handling, timeline
                        standardization, outlier detection (IQR method)</li
                      >
                      <li
                        ><strong>Feature engineering</strong>: One-hot encoding,
                        binary indicators, StandardScaler normalization,
                        cyclical sin/cos encoding for temporal continuity, lag
                        features with <code>.shift()</code></li
                      >
                      <li
                        ><strong>Exploratory analysis</strong>:
                        <code>.describe()</code> for statistics,
                        <code>.corr()</code> for relationships,
                        <code>.groupby()</code> for segmentation, professional
                        matplotlib visualizations</li
                      >
                      <li
                        ><strong>Model development</strong>: LinearRegression
                        and RandomForestRegressor with scikit-learn,
                        chronological train-test splitting, proper evaluation on
                        unseen future data</li
                      >
                      <li
                        ><strong>Performance evaluation</strong>: MAE/RMSE/RÂ²
                        metric calculation, TimeSeriesSplit cross-validation,
                        statistical confidence intervals, feature importance
                        interpretation</li
                      >
                    </ul>
                    <p
                      >Congratulations! ðŸ¥³ You've completed the full
                      professional ML workflow from raw data to deployment-ready
                      system. Your Capital City Bikes forecasting system
                      demonstrates production-grade rigor across data
                      preparation, feature engineering, model development, and
                      evaluation - the complete skillset that distinguishes
                      professional ML engineers from basic model builders.
                      You're now ready to tackle real-world transportation
                      forecasting challenges with confidence, systematic
                      methodology, and stakeholder-ready communication!</p
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </body>
</html>
